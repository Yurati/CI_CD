plugins {
    id 'org.springframework.boot' version '2.2.0.RELEASE'
    id "com.palantir.docker" version "0.22.1"
}

apply plugin: 'java'
apply plugin: 'application'
apply plugin: 'io.spring.dependency-management'
apply plugin: "com.palantir.docker"

mainClassName = 'Hello'

repositories {
    mavenCentral()
}

sourceCompatibility = 1.8
targetCompatibility = 1.8

dependencies {
    compile "joda-time:joda-time:2.2"
    testCompile group: 'org.assertj', name: 'assertj-core', version: '3.13.2'

    compile "org.springframework.boot:spring-boot-starter-web"
    testCompile"org.springframework.boot:spring-boot-starter-test"
}

group = 'ldudek'

bootJar {
    archiveBaseName = 'test'
    archiveVersion =  '1.0.0'
}


task unpack(type: Copy) {
    dependsOn bootJar
    from(zipTree(tasks.bootJar.outputs.files.singleFile))
    into("build/dependency")
}
docker {
    name "${project.group}/${bootJar.baseName}"
    copySpec.from(tasks.unpack.outputs).into("dependency")
    buildArgs(['DEPENDENCY': "dependency"])
}
